<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctors List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .doctor-card {
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      border-radius: 12px;
    }
    .doctor-card:hover {
      transform: translateY(-5px);
      box-shadow: 0px 8px 20px rgba(0,0,0,0.15);
    }
    .card-title {
      font-weight: 600;
      font-size: 1.25rem;
      color: #0d6efd;
    }
    .card-text strong {
      color: #495057;
    }
  </style>
</head>
<body>
  
  <a href="../adminDashboard.html">
    <button class="btn btn-primary mx-3 my-3">Go back</button> 
  </a>
  <div class="container py-5">
    
    <h2 class="mb-4 text-center fw-bold">üë®‚Äç‚öïÔ∏è Doctors List</h2>



    <div class="input-group shadow-sm rounded-3">
        <span class="input-group-text bg-white border-0">
        <i class="bi bi-search text-muted"></i>
        </span>
        <input 
        id="searchInput"
        type="search" 
        class="form-control border-0" 
        placeholder="Search by username or email" 
        aria-label="Search"

        onkeyup="filterUser()"
        >
        <button class="btn btn-primary rounded-end-3">
        Search
        </button>
    </div>

    <br>
    <div id="doctorsContainer" class="row g-4">
     
    </div>

    <nav>
      <ul id="pagination" class="pagination justify-content-center mt-4"></ul>
    </nav>
  </div>

  <script type="module">
    import { toggleDoctorLock ,getAllDoctors, requireAuth, searchDoctor, handleAuthError } from "../../assets/api.js";

    requireAuth();

    const doctorsContainer = document.getElementById("doctorsContainer");
    const pagination = document.getElementById("pagination");

    let currentKeyword = "";
    let currentPage = 0;
    const pageSize = 10; 

    async function loadDoctors(page = 0) {
      try {
        const data = await getAllDoctors(page, pageSize);
        renderDoctors(data.content);
        renderPagination(data, false);
      } catch (error) {
        handleAuthError(error);
        doctorsContainer.innerHTML = `<p class="text-danger">Error loading doctors</p>`;
      }
    }

    async function filterUser(page = 0) {
      const keyword = document.getElementById("searchInput").value.trim();
      currentKeyword = keyword;

      if (keyword === "") {
        loadDoctors(page);
        return;
      }

      try {
        const data = await searchDoctor(keyword, page, pageSize);
        renderDoctors(data.content);
        renderPagination(data, true);
      } catch (error) {
        handleAuthError(error);
        doctorsContainer.innerHTML = `<p class="text-danger">Error searching doctors</p>`;
      }
    }

    function renderDoctors(doctors) {
      doctorsContainer.innerHTML = "";

      if (!doctors || doctors.length === 0) {
        doctorsContainer.innerHTML = `<p class="text-muted text-center">No doctors found.</p>`;
        return;
      }

      doctors.forEach(doctor => {
        const card = document.createElement("div");
        card.className = "col-md-4";
        card.innerHTML = `
          <div class="card doctor-card shadow-sm h-100">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">${doctor.doctorName || "N/A"}</h5>
              <p class="card-text flex-grow-1">
                <strong>Email:</strong> ${doctor.user?.email || "N/A"}<br>
                <strong>Phone:</strong> ${doctor.phoneNumber || "N/A"}<br>
                <strong>Gender:</strong> ${doctor.gender || "N/A"}<br>
                
                <strong>Address:</strong> ${doctor.address || "N/A"}<br>
                <strong>Status:</strong> 
                  ${doctor.user?.accountLocked 
                    ? '<span class="badge bg-danger">Locked</span>' 
                    : '<span class="badge bg-success">Active</span>'}
              </p>
              <button 
                class="btn ${doctor.user?.accountLocked ? "btn-success" : "btn-danger"} mt-auto"
                onclick="toggleLock(${doctor.user?.userId}, ${doctor.user?.accountLocked})">
                ${doctor.user?.accountLocked ? "Unlock" : "Lock"}
              </button>
            </div>
          </div>
        `;
        doctorsContainer.appendChild(card);
      });
    }


    function renderPagination(pageData, isSearch = false) {
      pagination.innerHTML = "";

      if (pageData.totalPages <= 1) return; 

      for (let i = 0; i < pageData.totalPages; i++) {
        const li = document.createElement("li");
        li.className = `page-item ${i === pageData.number ? "active" : ""}`;
        li.innerHTML = `<a class="page-link" href="#">${i + 1}</a>`;
        li.onclick = (e) => {
          e.preventDefault();
          if (isSearch) {
            filterUser(i);
          } else {
            loadDoctors(i);
          }
        };
        pagination.appendChild(li);
      }
    }

    async function toggleLock(userId, isLocked) {
      try {
        await toggleDoctorLock(userId);
        alert(`User ${isLocked ? "unlocked" : "locked"} successfully`);
        if (currentKeyword) {
          filterUser(currentPage);
        } else {
          loadDoctors(currentPage);
        }
      } catch (error) {
        console.error("Error toggling lock", error);
        alert("Failed to update user status");
      }
    }
    window.toggleLock = toggleLock;

    window.filterUser = filterUser;


    loadDoctors();

  </script>
</body>
</html>















