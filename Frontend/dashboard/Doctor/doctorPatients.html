<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Doctor Patients</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <script type="module">
    import { getDoctorPatients, handleAuthError, requireAuth } from "../../assets/api.js";

    document.addEventListener("DOMContentLoaded", async () => {
      requireAuth(); 
      const container = document.getElementById("patients-container");

      try {
        const patients = await getDoctorPatients();

        if (!patients || patients.length === 0) {
          container.innerHTML = `<div class="alert alert-info text-center">No patients found.</div>`;
          return;
        }

        patients.forEach(p => {
          const card = document.createElement("div");
          card.className = "col-md-4";

          card.innerHTML = `
            <div class="card shadow-sm h-100">
              <div class="card-body text-center">
                <h5 class="card-title text-primary fw-bold">${p.fullName}</h5>
                <p class="card-text"><i class="bi bi-envelope"></i> <strong>Email:</strong> ${p.user.email}</p>
                <p class="card-text"><i class="bi bi-geo-alt"></i> <strong>Address:</strong> ${p.address}</p>
                <p class="card-text"><i class="bi bi-gender-ambiguous"></i> <strong>Gender:</strong> ${p.gender || "N/A"}</p>
                <p class="card-text"><i class="bi bi-telephone"></i> <strong>Contact:</strong> ${p.phonenumber || "N/A"}</p>
              </div>
            </div>
          `;

          container.appendChild(card);
        });
      } catch (e) {
        handleAuthError(e);
      }
    });
  </script>


  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">

    <a href="../doctorDashboard.html">
        <button class="btn btn-primary mx-3 my-3">Go back</button>
    </a>
  <div class="container py-5">
    <h1 class="text-center text-primary mb-4">My Patients</h1>
    <div id="patients-container" class="row g-4"></div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
